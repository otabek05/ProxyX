import{V as _,W as B,X as b,Y as U,r as u,Z as Y,_ as N,j as t,$ as q,a0 as O,a1 as I,a2 as z,l as $,a3 as K,a4 as H,a5 as V,a6 as X,a7 as Z,a8 as G,u as J,a9 as Q,aa as x,ab as k,B as D,S as ee,ac as A,ad as re,T as P,I as te,n as se,o as ne,c as E,ae as oe,af as ae}from"./index-D9AldSdA.js";function le(e){return B("MuiLink",e)}const ie=_("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]),ce=({theme:e,ownerState:s})=>{const n=s.color;if("colorSpace"in e&&e.colorSpace){const p=b(e,`palette.${n}.main`)||b(e,`palette.${n}`)||s.color;return e.alpha(p,.4)}const d=b(e,`palette.${n}.main`,!1)||b(e,`palette.${n}`,!1)||s.color,o=b(e,`palette.${n}.mainChannel`)||b(e,`palette.${n}Channel`);return"vars"in e&&o?`rgba(${o} / 0.4)`:U(d,.4)},F={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},ue=e=>{const{classes:s,component:n,focusVisible:d,underline:o}=e,p={root:["root",`underline${I(o)}`,n==="button"&&"button",d&&"focusVisible"]};return z(p,le,s)},de=q($,{name:"MuiLink",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[s.root,s[`underline${I(n.underline)}`],n.component==="button"&&s.button]}})(K(({theme:e})=>({variants:[{props:{underline:"none"},style:{textDecoration:"none"}},{props:{underline:"hover"},style:{textDecoration:"none","&:hover":{textDecoration:"underline"}}},{props:{underline:"always"},style:{textDecoration:"underline","&:hover":{textDecorationColor:"inherit"}}},{props:({underline:s,ownerState:n})=>s==="always"&&n.color!=="inherit",style:{textDecorationColor:"var(--Link-underlineColor)"}},{props:({underline:s,ownerState:n})=>s==="always"&&n.color==="inherit",style:e.colorSpace?{textDecorationColor:e.alpha("currentColor",.4)}:null},...Object.entries(e.palette).filter(H()).map(([s])=>({props:{underline:"always",color:s},style:{"--Link-underlineColor":e.alpha((e.vars||e).palette[s].main,.4)}})),{props:{underline:"always",color:"textPrimary"},style:{"--Link-underlineColor":e.alpha((e.vars||e).palette.text.primary,.4)}},{props:{underline:"always",color:"textSecondary"},style:{"--Link-underlineColor":e.alpha((e.vars||e).palette.text.secondary,.4)}},{props:{underline:"always",color:"textDisabled"},style:{"--Link-underlineColor":(e.vars||e).palette.text.disabled}},{props:{component:"button"},style:{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${ie.focusVisible}`]:{outline:"auto"}}}]}))),pe=u.forwardRef(function(s,n){const d=Y({props:s,name:"MuiLink"}),o=N(),{className:p,color:l="primary",component:i="a",onBlur:y,onFocus:v,TypographyClasses:w,underline:S="always",variant:m="inherit",sx:f,...j}=d,[C,c]=u.useState(!1),R=h=>{V(h.target)||c(!1),y&&y(h)},L=h=>{V(h.target)&&c(!0),v&&v(h)},g={...d,color:l,component:i,focusVisible:C,underline:S,variant:m},T=ue(g);return t.jsx(de,{color:l,className:O(T.root,p),classes:w,component:i,onBlur:R,onFocus:L,ref:n,ownerState:g,variant:m,...j,sx:[...F[l]===void 0?[{color:l}]:[],...Array.isArray(f)?f:[f]],style:{...j.style,...S==="always"&&l!=="inherit"&&!F[l]&&{"--Link-underlineColor":ce({theme:o,ownerState:g})}}})});function fe(){const e=X(),s=Z(),{loadCompany:n,setUserRole:d}=G(),{showSnackbar:o}=J(),[p,l]=u.useState(180),i=u.useRef(null),[y,v]=u.useState("login"),[w,S]=u.useState(!1),[m,f]=u.useState(!1),{handleSubmit:j,control:C,formState:{errors:c},trigger:R}=Q({defaultValues:{email:"",password:"",otp:""}}),L=()=>{l(180),i.current&&clearInterval(i.current),i.current=setInterval(()=>{l(r=>r<=1?(clearInterval(i.current),o("OTP 만료. 다시 시도해주세요.","error"),v("login"),0):r-1)},1e3)};u.useEffect(()=>()=>{i.current&&clearInterval(i.current)},[]),u.useEffect(()=>{const r=x.get("access_token");!x.get(k.KEY)&&r&&(x.remove("access_token"),x.remove("refresh_token"),x.remove(k.KEY)),r&&e.push("/")},[e]);const g=r=>({email:r.email,password:r.password,otp:r.otp,phone:"",ipAddress:"",deviceType:""}),T=async r=>{f(!0);try{await oe(g(r))instanceof Error?o("이메일 또는 비밀번호가 올바르지 않습니다.","error"):(o("인증번호가 전송되었습니다.","success"),v("otp"),L())}finally{f(!1)}},h=async r=>{f(!0);try{const a=await ae(g(r));a instanceof Error?o(a.message,"error"):(o("로그인 성공!","success"),x.set("access_token",a.access_token),x.set("refresh_token",a.refresh_token),x.set(k.KEY,k.COMPANY),d(k.COMPANY),n(),s("/",{replace:!0}))}finally{f(!1)}},M=async r=>{y==="login"?await T(r):await h(r)},W=()=>{const r=Math.floor(p/60),a=p%60;return`${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`};return t.jsxs(D,{sx:{textAlign:"center",mb:5},children:[t.jsx($,{sx:{mb:2},variant:"h5",children:"EASY 365 로그인"}),t.jsx(D,{children:t.jsx("form",{onSubmit:j(M),children:t.jsxs(ee,{spacing:3,children:[t.jsx(A,{name:"email",control:C,rules:{required:"이메일을 입력해주세요.",validate:r=>re(r)||"유효한 이메일을 입력해주세요."},render:({field:r})=>t.jsx(P,{...r,label:"이메일",type:"email",variant:"standard",disabled:y==="otp",fullWidth:!0,error:!!c.email,helperText:c.email?.message,placeholder:"example@email.com"})}),y==="login"&&t.jsxs(t.Fragment,{children:[t.jsx(A,{name:"password",control:C,rules:{required:"비밀번호를 입력해주세요."},render:({field:r})=>t.jsx(P,{...r,label:"비밀번호",type:w?"text":"password",fullWidth:!0,variant:"standard",error:!!c.password,helperText:c.password?.message,InputProps:{endAdornment:t.jsx(te,{position:"end",children:t.jsx(se,{onClick:()=>S(a=>!a),edge:"end",children:t.jsx(ne,{icon:w?"solar:eye-bold":"solar:eye-closed-bold"})})})}})}),t.jsx(pe,{href:"/forget-password",underline:"hover",sx:{alignSelf:"flex-end",mb:1},children:"비밀번호를 잊으셨나요?"}),t.jsx(E,{type:"submit",variant:"contained",fullWidth:!0,color:"inherit",sx:{p:1},disabled:m,children:m?"로딩중...":"로그인"})]}),y==="otp"&&t.jsxs(t.Fragment,{children:[t.jsx(A,{name:"otp",control:C,rules:{required:"인증번호를 입력해주세요."},render:({field:r})=>t.jsx(P,{...r,label:"인증번호",type:"number",variant:"standard",fullWidth:!0,error:!!c.otp,helperText:c.otp?.message})}),t.jsxs($,{sx:{mt:2},children:["남은 시간: ",W()]}),t.jsx(E,{type:"submit",variant:"contained",fullWidth:!0,color:"inherit",sx:{p:1},disabled:m,children:m?"로딩중...":"인증하기"})]})]})})})]})}function ye(){return t.jsx(t.Fragment,{children:t.jsx(fe,{})})}export{ye as default};
